{% extends "base.html" %}
{% block title %}Tasks{% endblock %}
{% block content %}
    <h1><a href="/">Bizarro editor</a> <span> &rarr; <a href="./">{{branch}}</a></span></h1>
    
        <form action="/tree/{{safe_branch}}/save/{{edit_path}}" method="POST">
        
        <nav class="nav-tabs" role="navigation" style="text-align:left;">
            <!--div class="layout-breve"-->
            <ul class="list-form slug">
                <li class="form-field">
                    <label for="url-slug">Slug</label>
                    <input name="url-slug" type="text" value="{{url_slug}}" />  
                </li>                      
            </ul>
            <!--/div-->
            <ul class="layout-semibreve layout-tight">
                {% for iso in languages %}
                    {% set lang = languages[iso] %}
                    {% if iso == 'en' %}
                        {% set class = 'nav-tab state-active' %}
                    {% else %}
                        {% set class = 'nav-tab' %}
                    {% endif %}
                    
                    <li id="{{iso}}-nav" class="{{class}}"><a class="nav-tab-link" href="" onclick="return show{{lang}}Form()">{{lang}}</a></li>
                {% endfor %}
            </ul>
        </nav>
        <ul class="detailed-info sketchy">
            <li><a href="">Stats</a></li>
            <li><a href="history.html">History</a></li>
        </ul>

        <div class="layout-breve">
            {% for iso in languages %}
                {% if iso == 'en' %}
                    {% set title = front['title'] %}
                    {% set display = 'block' %}
                {% else %}
                    {% set title = front['title-'+iso] %}
                    {% set body = front['body-'+iso] %}
                    {% set display = 'none' %}
                {% endif %}
            
                <div id="{{languages[iso]}}-form" style="display: {{display}}" class="glayout-minim glayout-major language-edit">
                    <div class="badge-heading badge-gov badge-teal">
                        <h2><input name="{{iso}}-title" value="{{title}}" type="text"></h2>
                    
                        {% with messages = get_flashed_messages() %}
                          {% if messages %}
                            <ul class="save-status-success">
                            {% for message in messages %}
                              <li>{{ message }}</li>
                            {% endfor %}
                            </ul>
                          {% endif %}
                        {% endwith %}
                    </div>
                    <ul class="list-form">
                        <li class="form-field">
                            <label for="body">Content</label>
                            <textarea id="{{iso}}-body" class="textarea" name="{{iso}}-body" type="text">{{body}}</textarea>
                        </li>                      
                    </ul>
                </div>
            {% endfor %}
                <div id="statistics">
                        <button id="authorize-button" style="visibility: hidden">Authorize</button>
                <div class="slab-blue info">
                        <h2><span class="big-number">{{page_views}}</span> <span>Views this week</span></h2>
                        <h2><span class="big-number">{{average_time_page}}s</span> <span>Average visit time</span></h2>
                    </div>
                </div>
                <div class="button-group" style="clear:both">
                    <input name="layout" value="{{front['layout']}}" type="hidden" />
                    <input name="hexsha" value="{{hexsha}}" type="hidden" />
                    <input type="submit" class="primary-button" value="Save"/>
                    <a href="{{view_path}}" class="button primary-button" target="_blank">Preview</a>
                    <a class="button button-unstyled sketchy" href="#">Archive</a>
                </div>
            </div>
                
            </form>
            <!-- dummy right hand section -->
            
        </div>            
        

    </form>
    <script type="text/javascript">
    
        {% for iso in languages %}
            {% set lang = languages[iso] %}
        
            function show{{lang}}Form()
            {
                {% for other_iso in languages %}
                    {% set other_lang = languages[other_iso] %}
                    document.getElementById('{{other_lang}}-form').style.display = 'none';
                    document.getElementById("{{other_iso}}-nav").className = "nav-tab";
                {% endfor %}

                document.getElementById('{{lang}}-form').style.display = 'block';
                var d = document.getElementById("{{iso}}-nav");
                d.className = d.className + " state-active";
                return false;
            }
        {% endfor %}

    </script>

{% endblock %}
