{% extends "base.html" %}
{% block title %}Activities{% endblock %}
{% set template_name = 'activities-list' %}
{% block body_class %}{{template_name}}{% endblock %}

{% block scripts %}
<script src="static/javascript/activities-list.js"></script>
{% endblock %}

{% block content %}
    <div class="row row--main activities-list__header">
      <p class="row__left">A view of work in progress on the site</p>
      <div class="toolbar toobar--right row__right">
        <a class="button button--green button--medium button--new-activity">Start a new activity</a>
      </div>
    </div>
    <div class="activities-list__main row row--main col__flex">
      {{ activity_box(in_progress_activities, "edited")}}
      {{ activity_box(feedback_activities, "feedback")}}
      {{ activity_box(endorsed_activities, "endorsed")}}
      {{ activity_box(published_activities.activities, "published")}}
    </div>
    <div class="modal-container">
    <div class="new-activity modal">
      <h3>Let teammates know what public need you are addressing.</h3>
      <form action="/start" method="POST">
        <textarea type="text" name="task_description" placeholder="clarifying the permitting application process for business owners" class="need"></textarea>
        <input name="task_beneficiary" type="hidden" class="need"/>
        <p class="text-detail width-three-fourths">Starting an activity gives you your own copy of the site to work in. Activities need to be reviewed by someone else in order to go live.</p> 
        <div class="toolbar toolbar--right">
          <a href="#" class="toolbar__item button button--medium button--close-modal">Cancel</a>
          <button type="submit" class="toolbar__item button button--medium button--green button--create-activity">Create</button>
        </div>         
      </form> 
    </div>
  </div>
{% endblock %}

{% macro activity_box(state_activities, activity_state) -%}
<div class="activity-box">
    <ul class="activity-box__list">
    {% for activity in state_activities %}
     <li class="activity activity--{{activity_state}}">
      <p class="activity__title"><a href="{{ activity.edit_path }}">{{ activity.task_description }}</a></p>
      <div class="row">
        <p class="activity__author row__left">Last edited by {{ activity.last_edited_email }}</p>
        <form action="/update" method="POST" class="row__right">
          <input type="hidden" name="branch" value="{{ activity.safe_branch }}">
        </form>
      </div>
      <div class="activity__actions row">
        <div class="row__left toolbar toolbar--left">
          <a class="toolbar__item" href="{{ activity.edit_path }}"><span class="fa fa-files-o"></span></a>
          <a class="toolbar__item" href="{{ activity.overview_path }}"><span class="fa fa-calendar-o"></span></a>
        </div>
        <div class="row__right toolbar toolbar--right">
          <a href="" class="toolbar__item"><span class="fa fa-trash"></span></a>
        </div>
      </div>
    </li>
    {% endfor %}
  </ul>
</div>
{%- endmacro %}