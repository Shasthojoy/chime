{% extends "base.html" %}

{% set template_name = 'articles-list' %}
{% block body_class %}{{template_name}}{% endblock %}

{% set breadcrumb_items = [{'name': 'Activities', 'url': '/'}] %}

{% block title %}Browse{% endblock %}

{% block content %}

<!-- task: {{ activity.task_description }} -->
<!-- beneficiary: {{ activity.task_beneficiary }} -->
<!-- template name: {{ template_name }} -->
{% set icon_class_lookup = {'folder': 'fa fa-folder-o', 'file': 'fa fa-file-text-o', 'category': 'fa fa-folder', 'article': 'fa fa-file-text'} %}
<div class="articles-list__main grid col__flex">
    {% for column in dir_columns %}
    {% set column_depth = loop.index %}
    {% if column_depth != 1 or (column_depth == 1 and dir_columns|length == 1) %}
    <div class="dir grid__item {% if column_depth == 4 %}width-one-half end-row{% else %}width-one-fourth{% endif %}">
      {% if column_depth == 2 %}
      <h2>Categories</h2>
      <div class="selection-box box-add-file-folder">
        <form action="." method="POST" class="form-one-line">
            <input class="form-one-line__input" name="request_path" placeholder="Add Category" id="create-category-name" type="text" />
            <input name="create_what" value="category" type="hidden" />
            <input name="create_path" value="{{column['base_path']}}" type="hidden" />
            <input class="form-one-line__submit button" name="action" type="submit" id="create-category-button" value="Create" />
        </form>
      </div>
      {% elif column_depth == 3 %}
      <h2>Subcategories</h2>
      <div class="selection-box box-add-file-folder">
        <form action="." method="POST" class="form-one-line">
            <input class="form-one-line__input" name="request_path" placeholder="Add Subcategory" id="create-subcategory-name" type="text" />
            <input name="create_what" value="category" type="hidden" />
            <input name="create_path" value="{{column['base_path']}}" type="hidden" />
            <input class="form-one-line__submit button" name="action" type="submit" id="create-subcategory-button" value="Create" />
        </form>
      </div>
      {% elif column_depth == 4 %}
      <h2>Articles</h2>
      <div class="selection-box box-add-file-folder">
        <form action="." method="POST" class="form-one-line">
            <input class="form-one-line__input" name="request_path" placeholder="Add Article" id="create-article-name" type="text" />
            <input name="create_what" value="article" type="hidden" />
            <input name="create_path" value="{{column['base_path']}}" type="hidden" />
            <input class="form-one-line__submit button" name="action" type="submit" id="create-article-button" value="Create" />
        </form>
      </div>
      {% endif %}
      <ul class="dir">
        {% for file in column['files'] %}
         <!-- file type: {{file['display_type']}}, file name: {{file['name']}}, file title: {{file['title']}} -->
         <li class="dir-item {% if file['selected'] == True %}is-selected{% endif %}">
            <a class="dir-item__name {{file['display_type']}}" href="{{file['edit_path']}}"><span class="dir-item__display-type {{icon_class_lookup[file['display_type']]}}"></span>{{ file['title'] }}</a>
            <div class="dir-item__actions toolbar--right">
            {% if column_depth == 4 %}
              <form action="." method="POST" class="toolbar__item">
                <input name="request_path" value="{{file['file_path']}}" type="hidden">
                <button name="action" type="submit" value="delete" class="dir-item__action dir-item__action--delete"><span class="fa fa-trash"></span></button>
              </form>
            {% else %}
              <a href="{{file['modify_path']}}" class="toolbar__item dir-item__action"><span class="fa fa-pencil"></span></a>
            {% endif %}
            </div>
          </li>
        {% endfor %}   
      </ul>
    </div>
    {% endif %}
    {% endfor %}
</div>
{% endblock %}

